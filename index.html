<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- tailwind cdn -->
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <!-- tailwind cdn -->
    <title>Break even tool</title>
    <!-- styles in html for easier updating -->
    <style>
      body {
        font-family: "Century Gothic", sans-serif;
      }
    </style>
    <!-- end of style tag -->
  </head>
  <body class="bg-gray-100">
    <header class="flex px-8 py-3 h-16 shadow-lg">
      <img
        src="https://upload.wikimedia.org/wikipedia/en/thumb/a/ac/Flex_logo_%282015%29.svg/640px-Flex_logo_%282015%29.svg.png"
        alt="Flex logo"
        class="header__logo"
      />
      <ul class="flex flex-auto justify-end items-center text-sm">
        <li class="pl-4 hover:underline">
          <a
            href="https://flextronics365.sharepoint.com/sites/additivemanufacturing"
            >Flex Additive Home Page</a
          >
        </li>
        <li class="pl-4 hover:underline">
          <a
            href="https://flextronics365.sharepoint.com/sites/aminstantquoting/"
            >Flex Additive Instant quoting tool</a
          >
        </li>
        <li class="pl-4 hover:underline">
          <a
            href="https://apps.powerapps.com/play/daa6a785-3ff2-4779-8743-520fecd48ea4?tenantId=3f0e69e0-eb38-4eb2-b4ee-52919719d31e?l=en-us"
            >Flex Additive Manufacturing Digital Catalog</a
          >
        </li>
      </ul>
    </header>
    <main class="max-w-screen-lg mx-auto pt-8">
      <h1 class="mb-8 text-center text-5xl font-bold">Break Even Tool</h1>
      <!-- Input form section -->
      <form class="grid grid-cols-3 place-content-center mb-8">
        <!-- tooling cost -->
        <div class="m-4">
          <label for="tooling-cost" class="block text-xs mb-2"
            >Tooling cost</label
          >
          <span>$</span>
          <input
            class="w-11/12"
            type="number"
            id="tooling-cost"
            name="tooling-cost"
            min="1"
            placeholder="Price in usd"
            step="0.01"
          />
        </div class="m-4"> 
        <!-- injection cost -->
        <div class="m-4">
          <label for="injection-cost" class="block text-xs mb-2"
            >Injection cost</label
          >
          <span>$</span>
          <input
            class="w-11/12"
            type="number"
            id="injection-cost"
            name="injection-cost"
            min="1"
            placeholder="Price in usd"
            step="0.01"
          />
        </div>
        <!-- mjf cost -->
        <div class="m-4">
          <label for="mjf-cost" class="block text-xs mb-2">MJF cost</label>
          <span>$</span>
          <input
            class="w-11/12"
            type="number"
            id="mjf-cost"
            name="mjf-cost"
            min="1"
            placeholder="Price in usd"
            step="0.01"
          />
        </div>
        <!-- Parts per period -->
        <div class="m-4">
          <label for="parts-period" class="block text-xs mb-2"
            >Manufactured parts per period</label
          >
          <input
            class="w-11/12"
            type="number"
            id="parts-period"
            name="parts-period"
            min="10"
            placeholder="Manufactured parts per period"
            step="1"
          />
        </div>
        <!-- Months of period -->
        <div class="m-4">
          <label for="time-period" class="block text-xs mb-2"
            >Time span for the injection molding</label
          >
          <input
            class="w-11/12"
            type="number"
            id="time-period"
            name="time-period"
            min="1"
            placeholder="Time span in months"
            step="1"
          />
        </div>
        <input 
        class="col-start-2 place-self-center m-4 h-6 w-3/4"
        type="button" value="Find break-even" id="submit-btn" />
      </form>
      <!-- chart render section -->
      <div class="w-3/4 mx-auto">
        <canvas id="chart" width="400" height="250"></canvas>
      </div>
      <!--  -->
    </main>
    <!--  -->

    <!-- chartJS scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- end of chartJS scripts -->
    <!-- sharepoint does not update data over referrenced files, instead write your scripts below -->
    <script>
      //get DOM inputs data
      let $toolingCost = document.getElementById("tooling-cost");
      let $injectionCost = document.getElementById("injection-cost");
      let $MJFCost = document.getElementById("mjf-cost");
      let $injectedPartsPerPeriod = document.getElementById("parts-period");
      let $timePeriod = document.getElementById("time-period");

      //get input button
      let $updateBtn = document.querySelector("#submit-btn");

      //create initial data for the chart
      const initialChartData = {
        months: [1, 2, 3],
        partsOverTime: [1000, 2000, 3000],
        toolingCost: 50000,
        injectionCost: [51.91, 26.91, 18.57],
        MJFCost: [50, 50, 50],
        breakEvenPoint: 50000 / (50 - 1.91),
      };
      //declare dynamic data
      let dynamicChartData;

      //create an array from a period of time
      function createPeriodOfTime(range) {
        let rangeList = [];
        for (let i = 1; i < range + 1; i++) {
          rangeList.push(i);
        }
        return rangeList;
      }

      //increase injected part qty by the amount of periods (injected parts * period)
      function injectedPartsOverTime(range, injectedParts) {
        let partsArray = [];
        for (let i = 1; i < range + 1; i++) {
          partsArray.push(i * injectedParts);
        }
        return partsArray;
      }

      //calculate injection cost per part: ((tooling cost / injected parts) + injection cost)
      //((injection moulding unit cost * quantity) + tooling cost) / quantity
      function getInjectionCostPerPart(
        toolingCost,
        injectedParts,
        costPerPart
      ) {
        return (injectedParts * costPerPart + toolingCost) / injectedParts;
      }

      //calulate breakeven point
      function calculateBreakEvenPoint(toolingCost, injectionCost, MJFCost) {
        return Number(toolingCost / (MJFCost - injectionCost));
      }

      //fucntion to create a molding chart
      function breakEvenChart(ctx, chartData) {
        //we create a new chart object
        const chart = new Chart(ctx, {
          type: "scatter",
          data: {
            //period of time
            labels: chartData.partsOverTime,
            datasets: [
              {
                //mjf costs
                type: "line",
                label: "Cost per part: MJF",
                data: chartData.MJFCost,
                borderColor: "rgba(255, 159, 64, 1)",
                // borderWidth: 0,
                pointRadius: 0,
                hitRadius: 0,
              },
              {
                //Injection part costs
                type: "line",
                label: "Injection molding cost per part",
                data: chartData.injectionCost,
              },
              {
                //breakeven point
                type: "scatter",
                label: "Breakeven Point",
                data: [
                  {
                    x: chartData.breakEvenPoint,
                    y: chartData.MJFCost[0],
                  },
                ],
                borderColor: "rgba(255, 50, 64, 1)",
              },
            ],
          },
          options: {
            scales: {
              x: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Injected parts per period",
                },
              },
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Price in USD",
                },
              },
            },
          },
        });
        return chart;
      }

      function renderCharts() {
        const ctx = document.querySelector("#chart").getContext("2d");
        return breakEvenChart(ctx, initialChartData);
      }

      //function to update data of the chart
      function updateChartData() {
        //set dynamic data for the chart
        let chartData = {
          months: Number($timePeriod.value),
          partsOverTime: Number($injectedPartsPerPeriod.value),
          toolingCost: Number($toolingCost.value),
          injectionCost: Number($injectionCost.value),
          MJFCost: Number($MJFCost.value),
          breakEvenPoint: 0,
        };

        //create data props for the chart

        //calculate the break evene point
        chartData.breakEvenPoint = calculateBreakEvenPoint(
          chartData.toolingCost,
          chartData.injectionCost,
          chartData.MJFCost
        );

        //create a month array
        chartData.monthsArray = createPeriodOfTime(chartData.months);

        //create an injected parts array
        chartData.partsOverTimeArray = injectedPartsOverTime(
          chartData.months,
          chartData.partsOverTime
        );

        //create an array of injection costs
        chartData.injectionCostArray = chartData.partsOverTimeArray.map(
          (parts) =>
            getInjectionCostPerPart(
              chartData.toolingCost,
              parts,
              chartData.injectionCost
            )
        );

        //we create an array of mjf cost duplicates to fill a line
        chartData.MJFCostArray = createPeriodOfTime(chartData.months).map(
          (month) => (month = chartData.MJFCost)
        );

        return chartData;
      }

      //function to update chart props
      function updateChartProps(chart, chartData) {
        //update labels
        chart.data.labels = chartData.partsOverTimeArray;

        //update mjf cost
        chart.data.datasets[0].data = chartData.MJFCostArray;

        //update injection cost per part
        chart.data.datasets[1].data = chartData.injectionCostArray;

        //update the break even point
        chart.data.datasets[2].data[0] = {
          x: chartData.breakEvenPoint,
          y: chartData.MJFCost,
        };

        //update chart data
        chart.update();
      }

      //chart rendering
      const BEChart = renderCharts();

      //event listener to update data
      $updateBtn.addEventListener("click", () => {
        dynamicChartData = updateChartData();
        updateChartProps(BEChart, dynamicChartData);
      });

      //
    </script>
  </body>
</html>
